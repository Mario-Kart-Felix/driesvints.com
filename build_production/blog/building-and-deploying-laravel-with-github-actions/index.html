<!DOCTYPE html>
<html lang="en" class="bg-gray-100">

<!-- Meta -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Site info -->
<title>Building and Deploying Laravel with Github Actions | Dries Vints</title>

<meta property="og:type" content="website">
<meta property="og:title" content="Building and Deploying Laravel with Github Actions | Dries Vints">
<meta property="og:image" content="https://driesvints.com/assets/images/driesvints.jpg">
<meta property="og:url" content="https://driesvints.com/">
<meta property="og:locale" content="en_US" />
<meta property="twitter:site" content="@driesvints">
<meta property="twitter:creator" content="@driesvints">
<meta property="twitter:url" content="https://driesvints.com/">
<meta property="twitter:title" content="Building and Deploying Laravel with Github Actions | Dries Vints">
<meta property="twitter:image" content="https://driesvints.com/assets/images/driesvints.jpg">

    <meta name="description" content="I recently set up Github Actions for Laravel.io so I thought I&#039;d share what it takes to set up a Continuous Delivery pipeline with Github Actions. First,...">
    <meta property="og:description" content="I recently set up Github Actions for Laravel.io so I thought I&#039;d share what it takes to set up a Continuous Delivery pipeline with Github Actions. First,...">
    <meta property="twitter:description" content="I recently set up Github Actions for Laravel.io so I thought I&#039;d share what it takes to set up a Continuous Delivery pipeline with Github Actions. First,...">

    <meta property="article:published_time" content="2020-02-28" />

<link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title=" Atom Feed">

<!-- Stylsheets -->
<link href="https://fonts.googleapis.com/css?family=Muli:400,400i,600,600i,700,700i;Ubuntu+Mono" rel="stylesheet">
<link rel="stylesheet" href="/assets/build/css/main.css?id=4f8879b43f327f151f44">

<script src="https://kit.fontawesome.com/980abfb339.js"></script>


<div class="font-sans text-xl text-gray-700 leading-normal antialiased border-t-6 border-primary">
    <div class="bg-secondary text-white font-semibold hover:underline py-3 px-6" target="_blank">
        <div class="wrapper text-center">
            <a class="focus:underline focus:bg-transparent" href="https://fullstackeurope.com/2020" target="_blank" rel="noopener">
                Join me at Full Stack Europe â†’
            </a>
        </div>
    </div>

        <div id="header" class="bg-black relative text-lg">
    <div class=" bg-cover bg-no-repeat" style="background-image: url('/assets/images/header-black.jpg'); background-position: top right">
        <div class="header-image header-image-small">
            <div class="text-white py-6 pb-2 sm:pb-12">
                <div class="max-w-8xl m-auto sm:flex text-center px-6 sm:px-12">
                    <div class="sm:flex-1 text-2xl font-bold sm:text-left mb-4">
                        <a href="/" class="hover:underline">Dries Vints</a>
                    </div>
                    <div class="sm:flex-2 sm:text-right">
                        <ul class="text-2xl">
    <li class="inline-block mr-6 sm:mr-10">
        <a href="/blog">
            <i class="enlarge fas fa-rss"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://twitter.com/driesvints" target="_blank">
            <i class="enlarge fab fa-twitter"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://github.com/driesvints" target="_blank">
            <i class="enlarge fab fa-github"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://www.youtube.com/driesvints" target="_blank">
            <i class="enlarge fab fa-youtube"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://instagram.com/driesvints" target="_blank">
            <i class="enlarge fab fa-instagram"></i>
        </a>
    </li>
    <li class="inline-block">
        <a href="https://www.linkedin.com/in/driesvints" target="_blank">
            <i class="enlarge fab fa-linkedin-in"></i>
        </a>
    </li>
</ul>
                    </div>
                </div>

                <div class="content sm:max-w-lg mx-auto text-shadow-lg font-semibold px-6 mt-16 md:mr-0 xl:mr-24">
                    
                </div>
            </div>
        </div>
    </div>
    <svg class="absolute z-0 left-0 bottom-0 block w-full h-8 sm:h-24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none">
        <polygon fill="#f7fafc" points="0,100 100,0 100,100"/>
    </svg>
</div>

    <div id="content">
        <div class="py-10 sm:py-20">
            <div id="post">
                <div class="mb-12">
                    <h1 class="font-bold text-4xl mb-6">Building and Deploying Laravel with Github Actions</h1>
                    <p class="block text-xs uppercase text-gray-600">
                        Published on February 28, 2020
                    </p>
                </div>

                <p>I recently set up <a href="https://github.com/features/actions">Github Actions</a> for <a href="https://laravel.io">Laravel.io</a> so I thought I'd share what it takes to set up a Continuous Delivery pipeline with Github Actions. First, before we continue, I suggest you read <a href="https://freek.dev/1546-using-github-actions-to-run-the-tests-of-laravel-projects-and-packages">this excellent blog post</a> by my buddy Freek Van der Herten where he already explains Github Actions in great detail. A lot of my setup will already be explained there so we'll focus on the most important and different bits and pieces here.</p>
<p>Let's look at the Github Actions workflow yaml file:</p>
<pre><code class="language-yaml">name: CI

on:
  push:
  pull_request:

jobs:
  tests:
    runs-on: ubuntu-latest
    name: Tests
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Cache dependencies
        uses: actions/cache@v1
        with:
          path: ~/.composer/cache/files
          key: dependencies-composer-${{ hashFiles('composer.json') }}

      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 7.3
          extensions: dom, curl, libxml, mbstring, zip, pcntl, pdo, sqlite, pdo_sqlite
          coverage: none

      - name: Install Composer dependencies
        run: composer install --prefer-dist --no-interaction --no-suggest

      - name: Install NPM dependencies
        run: npm install

      - name: Compile assets
        run: npm run production

      - name: Execute tests
        run: vendor/bin/phpunit --verbose

      - name: Deploy
        if: github.ref == 'refs/heads/master'
        run: curl ${{ secrets.ENVOYER_HOOK }}?sha=${{ github.sha }}</code></pre>
<p>The main difference with a package setup is that we don't do matrix builds. We only test with the specific setup from our production environment. Laravel.io still runs on PHP 7.3 so we only need to run that one.</p>
<p>As you can see, it's all pretty straight forward. We setup our build environment, install our dependencies, compile our assets (you can skip these two steps if you commit your assets), run tests and deploy the app.</p>
<p>You might notice that there's no step to set the application key. That's because I like to define this in my <code>phpunit.xml</code> file:</p>
<pre><code class="language-xml">&lt;server name="APP_KEY" value="base64:MaKZMMHCCw3VTGx76ahSnog22cNwdhh27d8sXhLSMmY="/&gt;</code></pre>
<p>This way there's always a test key available when running the test suite.</p>
<h2>Deploying the app</h2>
<pre><code class="language-yaml">- name: Deploy
  if: github.ref == 'refs/heads/master'
  run: curl ${{ secrets.ENVOYER_HOOK }}?sha=${{ github.sha }}</code></pre>
<p>This step will only run if the build is successful and when the build has run on master. We'll use an <code>ENVOYER_HOOK</code> secret env variable to trigger the Envoyer deployment url, pass in the specific commit we want to deploy. </p>
<p>As soon as the Envoyer url is triggered, it'll start deploying the specific commit. We'll need to define four steps after running the &quot;Install Composer Dependencies&quot; hook.</p>
<p>First we need to re-cache our routes and config:</p>
<pre><code class="language-bash">cd {{release}}

php artisan route:cache
php artisan config:cache</code></pre>
<p>Then we'll install the front-end assets:</p>
<pre><code class="language-bash">cd {{release}}

npm install</code></pre>
<p>And compile them:</p>
<pre><code class="language-bash">cd {{release}}

npm run production</code></pre>
<p>And eventually we'll run the migrations at the end:</p>
<pre><code class="language-bash">cd {{release}}

php artisan migrate --force</code></pre>
<p>After these steps Envoyer will activate the new release.</p>
<h2>Conclusion</h2>
<p>That's it! Pretty simple, right? Hope this helps you with your own app.</p>
                <div class="share mx-auto max-w-md mt-10 sm:mt-16 text-2xl text-center">
                    <p class="text-sm italic">
                        Like what you read? Feel free to share!
                        Make sure to <a href="https://twitter.com/driesvints" target="_blank">follow me on Twitter</a> to know when my next post is out.
                    </p>
                    <p class="share-links">
                        <a class="text-gray-500" target="_blank"
                           href="http://twitter.com/share?text=%22Building+and+Deploying+Laravel+with+Github+Actions%22+by+%40driesvints++-+&url=https%3A%2F%2Fdriesvints.com%2Fblog%2Fbuilding-and-deploying-laravel-with-github-actions">
                            <i class="enlarge fab fa-twitter"></i>
                        </a>

                        <a class="ml-4 text-gray-500" target="_blank"
                           href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdriesvints.com%2Fblog%2Fbuilding-and-deploying-laravel-with-github-actions&quote=%22Building+and+Deploying+Laravel+with+Github+Actions%22+by+Dries+Vints+-+">
                            <i class="enlarge fab fa-facebook-f"></i>
                        </a>

                        <a class="ml-4 text-gray-500" target="_blank"
                           href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdriesvints.com%2Fblog%2Fbuilding-and-deploying-laravel-with-github-actions&title=%22Building+and+Deploying+Laravel+with+Github+Actions%22+by+Dries+Vints+-+">
                            <i class="enlarge fab fa-linkedin-in"></i>
                        </a>
                    </p>

                    <div class="mx-auto max-w-md text-center">
    <p class="text-sm italic mb-8">
        Do you like what I do or did you ever found something that I made useful? Consider supporting me!
    </p>

    <p class="mb-0">
        <a class="btn text-sm mb-4" href="https://github.com/sponsors/driesvints" target="_blank">
            <i class="fab fa-github mr-1"></i> Support me regularly
        </a>

        <a class="btn text-sm" href="https://paypal.me/driesvints" target="_blank">
            <i class="fab fa-paypal mr-1"></i> Donate just once
        </a>
    </p>

    <p class="mb-4 text-sm">
        <a href="https://www.wishlistr.com/driesvints">
            Or gift something from my Wishlistr <i class="fas fa-gift"></i>
        </a>
    </p>
</div>
                </div>
            </div>
        </div>

                    <div class="bg-gray-200 text-xl sm:text-2xl border-t border-gray-300 px-6">
                <div class="max-w-4xl mx-auto flex">
                    <div class="flex-1 text-center sm:text-left border-r border-gray-300 pr-6 py-10 sm:py-20">
                                                    <p class="uppercase text-sm mb-2">&leftarrow; Previous post</p>
                            <a href="/blog/being-productive">Being Productive</a>
                                            </div>
                    <div class="flex-1 text-center sm:text-right px-4 py-10 pl-6 sm:py-20">
                                                    <p class="uppercase text-sm mb-2">Next post &rightarrow; </p>
                            <a href="/blog/blade-heroicons">Blade Heroicons</a>
                                            </div>
                </div>
            </div>
        
        <div id="about" class="max-w-3xl mx-auto px-6 py-10 sm:py-20">
    <div class="text-center mb-6">
        <a href="https://twitter.com/driesvints">
            <img src="https://www.gravatar.com/avatar/e8321183acdf47a9ce838afd13a964b5?s=180" width="90" class="rounded-full enlarge inline-block mb-4 sm:mb-0 sm:mr-4" alt="">
        </a>
    </div>

    <h2 class="text-4xl text-center font-bold mb-8">About Me</h2>

    <p class="mb-4">
        I'm a software engineer from Antwerp, Belgium. I work as one of the core team members of <a href="https://laravel.com">Laravel</a>, the popular PHP framework.
    </p>

    <p class="mb-4">
        My passions are <a href="https://github.com/driesvints">open-source</a>, building communities, managing software teams, and creating quality and maintainable products.
    </p>

    <p class="mb-4">
        I'm currently building <a href="https://eventy.io">Eventy</a>, an app for user group leaders, conference organisers, speakers, attendees, sponsors and venue owners.
    </p>

    <p class="mb-4">
        Together with my buddy <a href="https://twitter.com/riasvdv">Rias</a> I organize events for <a href="https://fullstackbelgium.be">Full Stack Belgium</a> in the cities of <a href="https://meetup.com/fullstackantwerp">Antwerp</a> and <a href="https://meetup.com/fullstackghent">Ghent</a>. And together with my buddy <a href="https://twitter.com/freekmurze">Freek</a> I organise <a href="https://fullstackeurope.com">Full Stack Europe</a>, the conference for the whole team.
    </p>

    <p>
        Follow me on Twitter at <a href="https://twitter.com/driesvints" target="_blank">@driesvints</a> where I also share some <a href="https://twitter.com/i/moments/1155908429698994181">Dev Tips</a> from time to time. You can contact me by <a href="mailto:dries@vints.io">email</a>.
    </p>
</div>
    </div>
</div>

<div class="border-t border-gray-300">
    <div class="max-w-6xl mx-auto text-sm text-gray-500 sm:flex px-6 py-8">
        <div class="sm:flex-1 text-center sm:text-left mb-6 sm:mb-0 sm:mt-3">
            &copy; Dries Vints
        </div>
        <div class="sm:flex-1 text-center sm:text-right">
            <ul class="text-2xl">
    <li class="inline-block mr-6 sm:mr-10">
        <a href="/blog">
            <i class="enlarge fas fa-rss"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://twitter.com/driesvints" target="_blank">
            <i class="enlarge fab fa-twitter"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://github.com/driesvints" target="_blank">
            <i class="enlarge fab fa-github"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://www.youtube.com/driesvints" target="_blank">
            <i class="enlarge fab fa-youtube"></i>
        </a>
    </li>
    <li class="inline-block mr-6 sm:mr-10">
        <a href="https://instagram.com/driesvints" target="_blank">
            <i class="enlarge fab fa-instagram"></i>
        </a>
    </li>
    <li class="inline-block">
        <a href="https://www.linkedin.com/in/driesvints" target="_blank">
            <i class="enlarge fab fa-linkedin-in"></i>
        </a>
    </li>
</ul>
        </div>
    </div>
</div>

<script src="/assets/build/js/main.js?id=c627d3cd8b2c97c1bcef"></script>

<script>
        (function(f, a, t, h, o, m){
            a[h]=a[h]||function(){
                (a[h].q=a[h].q||[]).push(arguments)
            };
            o=f.createElement('script'),
                m=f.getElementsByTagName('script')[0];
            o.async=1; o.src=t; o.id='fathom-script';
            m.parentNode.insertBefore(o,m)
        })(document, window, 'https://cdn.usefathom.com/tracker.js', 'fathom');
        fathom('set', 'siteId', 'GFHEOMNZ');
        fathom('trackPageview');
    </script>
