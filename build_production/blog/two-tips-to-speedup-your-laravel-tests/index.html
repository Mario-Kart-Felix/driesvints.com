<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Site info -->
    <title>Two tips to speedup your Laravel tests | Dries Vints</title>

    
            <meta property="article:published_time" content="2016-08-24" />
    
    <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title=" Atom Feed">

    <!-- Stylsheets -->
    <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,600,600i,700,700i;Ubuntu+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/build/css/main.css?id=da0adb7d3b8cf6146889">

    <!-- Google Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18478762-2']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body class="bg-grey-lightest font-sans text-lg text-grey-darker leading-normal antialiased border-t-8 border-theme-blue h-full">
    
    <div class="text-xl max-w-lg m-auto px-4 py-8 md:py-12">
            <div class="text-center italic text-sm mb-8">
        <a href="/">
            <img src="https://www.gravatar.com/avatar/e8321183acdf47a9ce838afd13a964b5?s=100" width="50" class="rounded-full enlarge">
        </a>
        <p class="font-bold mb-0">Dries Vints</p>
        <p class="md:text-xs">
            <a href="/">Home</a> |
            <a href="/blog">Blog</a> |
            <a href="https://twitter.com/driesvints">Twitter</a>
        </p>
    </div>

    <div class="text-center mb-12">
        <h1 class="mb-4">Two tips to speedup your Laravel tests</h1>
        <p class="italic text-sm">
            Published on August 24, 2016
        </p>
    </div>

    <div class="post max-w-md m-auto">
        <blockquote>
<p>This optimization has since <a href="https://github.com/laravel/laravel/blob/6806aaa3568382e9c8c7281a64b82a52b824e46f/phpunit.xml#L27">made it into the core</a> of the framework. </p>
</blockquote>
<p>I've seen two different tips for speeding up your tests in Laravel in the past week and thought I'd share them with you. For me, they made a significant impact on the speed of my tests.</p>
<h2>Lower the default crypt cost factor</h2>
<p>This is a huge time saver. <a href="https://twitter.com/codebyjeff">Jeff Madsen</a> recently showed us a tip in one of his <a href="http://codebyjeff.com/newsletter">Laravel Quick Tips newsletter</a> which speeds up your tests by lowering the default crypt cost factor.</p>
<blockquote>
<p>Ordinarily when you need to do a lot of testing with an object that can take a non-trivial amount of time to create, you just mock it. For example - creating a user is not just a matter of writing to databse, but it also has a relatively expensive password hashing process to go through. If your test count is still low this may not seem like a big deal, but when it grows and is run via Jenkins or Travis or similar, it can really slow things down. A mock lets you skip that, and save time.</p>
<p>However, there will be times where you may be forced to go through the actual User create process, such as in integration tests. In that case, this tip can be handy.</p>
<p>In your TestCase.php file, add this line about hashing rounds:</p>
<pre><code>public function createApplication()
{
    $app = require __DIR__.'/../bootstrap/app.php';

    $app-&gt;make(Illuminate\Contracts\Console\Kernel::class)-&gt;bootstrap();

    // add this line
    Hash::setRounds(5);

    return $app;
}</code></pre>
<p>This cuts the number of rounds from the default of 10 down to 5, shaving about half or even more of the time spent hashing. A big saving when you are running dozens of tests all day long!</p>
</blockquote>
<p>For me, this cut the time to run the new Laravel.io's test suite almost by half. Sweet!</p>
<h2>Use a precomputed hash in your factories</h2>
<p>Another tip is one which was recently added by <a href="https://twitter.com/adamwathan">Adam Wathan</a> in the Laravel skeleton: <a href="https://github.com/laravel/laravel/pull/3894">https://github.com/laravel/laravel/pull/3894</a></p>
<blockquote>
<p>Use a precomputed hash of the word &quot;secret&quot; instead of using <code>bcrypt</code> directly. Since <code>bcrypt</code> is intentionally slow, it can really slow down test suites in large applications that use factories to generate models in many tests.</p>
</blockquote>
<p>This additionally cut off some time to run the new Laravel.io test suite. So all in all these two tips made my test suite run twice as fast.</p>
                    <p class="text-center text-sm mt-12">
                                    <a href="/blog/getting-started-with-dotfiles">&laquo; Getting Started with Dotfiles</a>
                
                                    |
                
                                    <a href="/blog/1984">1984 &raquo;</a>
                            </p>
            </div>
    </div>

    <script src="/assets/build/js/main.js?id=0e7dc19ff43e9f3f44e0"></script>
</body>
</html>
